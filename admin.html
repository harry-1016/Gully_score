<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ff6b35">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>GULLY SCORE Admin</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#1e3c72,#2a5298);min-height:100vh}
        .container{max-width:600px;margin:0 auto;background:white;min-height:100vh;box-shadow:0 0 50px rgba(0,0,0,.3);position:relative}
        .app-header{background:linear-gradient(135deg,#ff6b35,#f7931e);padding:20px;text-align:center;box-shadow:0 4px 15px rgba(0,0,0,.2)}
        .app-name{font-family:'Bangers',cursive;font-size:40px;color:white;text-shadow:3px 3px 6px rgba(0,0,0,.4);letter-spacing:2px;margin-bottom:5px}
        .app-tagline{color:white;font-size:12px;opacity:.9}
        .admin-badge{background:#dc3545;color:white;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:bold;margin-top:8px;display:inline-block}
        .screen{display:none;padding:20px;min-height:calc(100vh - 100px)}
        #scoringScreen{padding:10px 12px}
        .screen.active{display:block}
        .hero-icon{width:150px;height:150px;margin:30px auto;background:linear-gradient(135deg,#ff6b35,#f7931e);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:70px}
        .start-btn{background:linear-gradient(135deg,#28a745,#20c997);color:white;border:none;padding:20px 60px;border-radius:50px;font-size:20px;font-weight:bold;cursor:pointer;margin-bottom:20px}
        .form-section{background:#f8f9fa;padding:20px;border-radius:12px;margin-bottom:20px}
        .section-header{display:flex;align-items:center;gap:10px;font-size:18px;font-weight:bold;color:#ff6b35;margin-bottom:15px}
        .form-group{margin-bottom:15px}
        .form-label{display:block;font-weight:600;margin-bottom:6px;color:#333;font-size:14px}
        .form-input{width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px}
        .form-input:focus{outline:none;border-color:#ff6b35}
        .team-name-row{display:flex;gap:10px;align-items:center;margin-bottom:10px}
        .expand-btn{background:#ff6b35;color:white;border:none;padding:8px 16px;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;white-space:nowrap}
        .players-container{display:none;margin-top:15px;padding-top:15px;border-top:2px solid #e0e0e0}
        .players-container.show{display:block}
        .player-input-row{display:flex;gap:8px;margin-bottom:8px;align-items:center}
        .player-number{background:#ff6b35;color:white;width:35px;height:35px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:14px;flex-shrink:0}
        .player-input{flex:1;padding:8px 10px;border:2px solid #e0e0e0;border-radius:6px;font-size:13px}
        .btn{padding:12px 30px;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer;margin:5px}
        .btn-primary{background:linear-gradient(135deg,#ff6b35,#f7931e);color:white}
        .btn-secondary{background:#6c757d;color:white}
        .toss-options,.decision-options{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:20px 0}
        .toss-card,.decision-card{background:white;border:3px solid #e0e0e0;border-radius:12px;padding:20px;text-align:center;cursor:pointer;transition:all .3s}
        .toss-card:hover,.decision-card:hover{border-color:#ff6b35;transform:scale(1.05)}
        .toss-card.selected{border-color:#ff6b35;background:linear-gradient(135deg,#fff3e0,#ffe0b2)}
        .decision-card.selected{border-color:#28a745;background:linear-gradient(135deg,#e8f5e9,#c8e6c9)}
        .toss-card-icon,.decision-card-icon{font-size:40px;margin-bottom:10px}
        .toss-card-text,.decision-card-text{font-weight:bold;color:#333}

        /* Scoring screen */
        .score-display{background:linear-gradient(135deg,#f8f9fa,#e9ecef);padding:12px;border-radius:12px;margin-bottom:8px;box-shadow:0 3px 15px rgba(0,0,0,.1)}
        .score-header{text-align:center;margin-bottom:8px;display:flex;justify-content:center;align-items:center;gap:8px;flex-wrap:wrap}
        .vs-teams{font-size:14px;color:#666;font-weight:600}
        .innings-badge{background:#ff6b35;color:white;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:bold;display:inline-block}
        .timer-badge{background:#28a745;color:white;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:bold;display:inline-block}
        .main-score{text-align:center;margin:6px 0}
        .score-number{font-size:38px;font-weight:bold;color:#ff6b35}
        .overs-info{font-size:13px;color:#666;margin-top:3px}
        .batsmen-info{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:7px}
        .batsman-card{background:white;padding:8px;border-radius:8px;border:2px solid #e0e0e0}
        .batsman-name{font-weight:bold;color:#333;margin-bottom:3px;display:flex;align-items:center;gap:5px;font-size:13px}
        .strike-indicator{width:8px;height:8px;background:#28a745;border-radius:50%;display:inline-block;animation:pulse 1.5s infinite;flex-shrink:0}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
        .batsman-stats{font-size:13px;color:#666}
        .bowler-info{background:white;padding:7px;border-radius:8px;text-align:center;border:2px solid #e0e0e0;margin-bottom:7px}
        .bowler-label{font-size:11px;color:#666;margin-bottom:3px}
        .bowler-name{font-weight:bold;color:#333;font-size:13px;margin-bottom:3px}
        .bowler-stats{font-size:13px;color:#666}
        .current-over{background:white;padding:8px;border-radius:8px;margin-bottom:7px}
        .over-title{font-size:13px;font-weight:bold;color:#333;margin-bottom:7px;text-align:center}
        .balls-container{display:flex;gap:6px;justify-content:center;flex-wrap:wrap}
        .ball-dot{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:12px;background:#e0e0e0;color:#333}
        .ball-dot.dot{background:#6c757d;color:white}
        .ball-dot.one,.ball-dot.two,.ball-dot.three{background:#28a745;color:white}
        .ball-dot.four{background:#007bff;color:white}
        .ball-dot.six{background:#9c27b0;color:white}
        .ball-dot.wicket{background:#dc3545;color:white}
        .ball-dot.wide,.ball-dot.noball{background:#ffc107;color:#333}
        .scoring-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:7px;margin-bottom:7px}
        .score-btn{padding:14px 5px;border:2px solid #e0e0e0;border-radius:12px;background:white;font-size:22px;font-weight:bold;cursor:pointer;transition:all .2s}
        .score-btn:active{transform:scale(.95)}
        .score-btn.runs{color:#28a745;border-color:#28a745}
        .score-btn.wicket{color:#dc3545;border-color:#dc3545}
        .score-btn.extra{color:#ffc107;border-color:#ffc107}
        .extras-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:7px;margin-bottom:7px}
        .extra-btn{padding:10px 5px;border:2px solid #ffc107;border-radius:12px;background:white;font-size:13px;font-weight:bold;color:#ffc107;cursor:pointer}
        .action-buttons{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-top:7px}
        .action-btn{padding:10px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;font-size:13px}
        .undo-btn{background:#ffc107;color:#333}
        .end-innings-btn{background:#dc3545;color:white}
        .scorecard-btn{background:#007bff;color:white}
        .end-match-btn{background:#28a745;color:white}
        .target-info{background:linear-gradient(135deg,#e3f2fd,#bbdefb);padding:10px;border-radius:8px;text-align:center;margin-bottom:7px;display:none}
        .target-info.show{display:block}
        .target-runs{font-size:18px;font-weight:bold;color:#1976d2;margin-bottom:3px}
        .target-balls{font-size:13px;color:#666}

        /* Modals */
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:1000;justify-content:center;align-items:center}
        .modal.active{display:flex}
        .modal-content{background:white;padding:25px;border-radius:15px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto}
        .modal-header{font-size:20px;font-weight:bold;color:#ff6b35;margin-bottom:16px;text-align:center}
        .player-option{padding:12px;border:2px solid #e0e0e0;border-radius:8px;cursor:pointer;text-align:center;font-weight:500;margin-bottom:8px}
        .player-option:hover{background:#f8f9fa;border-color:#ff6b35}

        /* Dismissal picker */
        .dismissal-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
        .dis-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:5px;padding:14px 8px;border:2px solid #e0e0e0;border-radius:12px;background:white;font-size:14px;font-weight:bold;color:#333;cursor:pointer;transition:all .2s}
        .dis-btn:hover{border-color:#dc3545;background:#fff5f5;transform:scale(1.04)}
        .dis-btn:active{transform:scale(.97)}
        .dis-btn .ico{font-size:26px}
        .dis-btn.retired-btn{grid-column:1/-1;flex-direction:row;border-color:#fd7e14;background:#fff8f0;color:#fd7e14;text-align:left;padding:12px 16px;gap:12px}
        .dis-btn.retired-btn:hover{background:#fff3e0}
        .dis-btn.retired-btn .lbl{flex:1}
        .dis-btn.retired-btn .sub{font-size:11px;font-weight:normal;color:#888;display:block;margin-top:2px}

        /* Pick-player buttons (runout / retired) */
        .pick-btn{width:100%;padding:14px;border:2px solid #e0e0e0;border-radius:10px;background:white;cursor:pointer;text-align:left;margin-bottom:8px;display:block}
        .pick-btn:hover{border-color:#ff6b35;background:#fff8f0}
        .pick-btn .pn{font-size:17px;font-weight:bold;color:#333}
        .pick-btn .pi{font-size:12px;color:#999;margin-top:3px}

        /* Inline scorecard */
        .sc-wrap{margin-top:10px;border:2px solid #ff6b35;border-radius:10px;overflow:hidden}
        .sc-head{background:linear-gradient(135deg,#ff6b35,#f7931e);color:white;padding:9px 14px;font-weight:bold;font-size:14px;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
        .sc-body{background:white;padding:12px;max-height:55vh;overflow-y:auto}
        .sc-table{width:100%;border-collapse:collapse;font-size:12px;margin-bottom:10px}
        .sc-table th{background:#f8f9fa;padding:6px 5px;text-align:left;font-size:11px;color:#666;font-weight:600;border-bottom:2px solid #e0e0e0}
        .sc-table th.r,.sc-table td.r{text-align:center}
        .sc-table td{padding:6px 5px;border-bottom:1px solid #f0f0f0}
        .sc-sec{font-weight:bold;color:#ff6b35;margin:8px 0 4px;font-size:13px}
    </style>
</head>
<body>
<div class="container">

<!-- LOGIN -->
<div id="loginScreen" class="screen active">
    <div class="app-header">
        <div class="app-name">GULLY SCORE</div>
        <div class="app-tagline">made with â¤ï¸ harry goud</div>
        <div class="admin-badge">ADMIN PANEL</div>
    </div>
    <div style="padding:40px 20px;text-align:center">
        <div style="font-size:80px;margin-bottom:30px">ğŸ”</div>
        <h2 style="font-size:24px;color:#333;margin-bottom:30px">Admin Login</h2>
        <div class="form-section" style="max-width:400px;margin:0 auto">
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" id="adminPassword" class="form-input" placeholder="Enter admin password" onkeypress="if(event.key==='Enter')checkPassword()">
            </div>
            <div id="loginError" style="color:#dc3545;margin:10px 0;font-size:14px;display:none"></div>
            <button class="btn btn-primary" onclick="checkPassword()" style="width:100%;margin-top:20px">Login</button>
        </div>
    </div>
</div>

<div class="app-header" id="mainHeader" style="display:none;position:relative">
    <div class="app-name">GULLY SCORE</div>
    <div class="app-tagline">made with â¤ï¸ harry goud</div>
    <div class="admin-badge">ADMIN PANEL</div>
    <button onclick="logout()" style="position:absolute;top:15px;right:15px;background:rgba(255,255,255,.2);color:white;border:none;padding:6px 12px;border-radius:6px;font-size:12px;cursor:pointer">Logout</button>
</div>

<!-- HOME -->
<div id="homeScreen" class="screen">
    <div style="text-align:center;padding:20px 0">
        <div class="hero-icon">ğŸ</div>
        <button class="start-btn" onclick="showSetup()">âš¡ New Match</button>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
            <button class="btn btn-secondary" onclick="showSavedTeams()">ğŸ“‹ Saved Teams</button>
            <button class="btn btn-secondary" onclick="showMatchHistory()">ğŸ“Š Match History</button>
        </div>
        <div id="currentTime" style="margin-top:20px;font-size:13px;color:#999"></div>
    </div>
</div>

<!-- SETUP -->
<div id="setupScreen" class="screen">
    <div class="form-section">
        <div class="section-header"><span>âš™ï¸</span><span>Match Setup</span></div>
        <div class="form-group">
            <label class="form-label">Overs</label>
            <input type="number" id="oversInput" class="form-input" value="5" min="1" max="50">
        </div>
    </div>
    <div class="form-section">
        <div class="section-header"><span>ğŸ</span><span>Team A</span></div>
        <div class="team-name-row">
            <input type="text" id="teamAName" class="form-input" placeholder="Team A Name" style="flex:1">
            <button class="expand-btn" onclick="togglePlayers('A')">Players â–¼</button>
        </div>
        <select id="teamALoadSelect" class="form-input" style="font-size:13px" onchange="loadSavedTeam('A',this.value)"><option value="">-- Load saved team --</option></select>
        <div id="teamAPlayers" class="players-container"><div id="teamAPlayersList"></div></div>
    </div>
    <div class="form-section">
        <div class="section-header"><span>ğŸ</span><span>Team B</span></div>
        <div class="team-name-row">
            <input type="text" id="teamBName" class="form-input" placeholder="Team B Name" style="flex:1">
            <button class="expand-btn" onclick="togglePlayers('B')">Players â–¼</button>
        </div>
        <select id="teamBLoadSelect" class="form-input" style="font-size:13px" onchange="loadSavedTeam('B',this.value)"><option value="">-- Load saved team --</option></select>
        <div id="teamBPlayers" class="players-container"><div id="teamBPlayersList"></div></div>
    </div>
    <div style="text-align:center;margin-top:20px">
        <button class="btn btn-primary" onclick="proceedToToss()">Proceed to Toss â†’</button>
    </div>
</div>

<!-- TOSS -->
<div id="tossScreen" class="screen">
    <div class="form-section">
        <div class="section-header"><span>ğŸª™</span><span>Toss</span></div>
        <p style="text-align:center;margin-bottom:20px;color:#666">Who won the toss?</p>
        <div class="toss-options">
            <div class="toss-card" onclick="selectTossWinner('A')"><div class="toss-card-icon">ğŸ†</div><div class="toss-card-text" id="tossTeamA">Team A</div></div>
            <div class="toss-card" onclick="selectTossWinner('B')"><div class="toss-card-icon">ğŸ†</div><div class="toss-card-text" id="tossTeamB">Team B</div></div>
        </div>
    </div>
    <div id="decisionSection" class="form-section" style="display:none">
        <div class="section-header"><span>ğŸ¯</span><span>Decision</span></div>
        <p style="text-align:center;margin-bottom:20px;color:#666">What do they choose?</p>
        <div class="decision-options">
            <div class="decision-card" onclick="selectDecision('bat')"><div class="decision-card-icon">ğŸ</div><div class="decision-card-text">BAT</div></div>
            <div class="decision-card" onclick="selectDecision('bowl')"><div class="decision-card-icon">âš¾</div><div class="decision-card-text">BOWL</div></div>
        </div>
    </div>
    <div style="text-align:center;margin-top:30px">
        <button class="btn btn-secondary" onclick="showSetup()">Back</button>
        <button class="btn btn-primary" id="startMatchBtn" style="display:none" onclick="startMatch()">Start Match</button>
    </div>
</div>

<!-- SCORING -->
<div id="scoringScreen" class="screen">
    <div class="score-display">
        <div class="score-header">
            <span class="vs-teams" id="vsTeams"></span>
            <span class="innings-badge" id="inningsBadge"></span>
            <span class="timer-badge" id="timerBadge">â± 00:00</span>
        </div>
        <div class="main-score">
            <div class="score-number" id="mainScore">0/0</div>
            <div class="overs-info" id="oversInfo">Overs: 0.0 / 5</div>
        </div>
        <div id="targetInfo" class="target-info">
            <div class="target-runs" id="targetRuns"></div>
            <div class="target-balls" id="targetBalls"></div>
        </div>
    </div>
    <div class="batsmen-info">
        <div class="batsman-card">
            <div class="batsman-name" id="s1Name"><span class="strike-indicator"></span>Striker</div>
            <div class="batsman-stats" id="s1Stats">0(0)</div>
        </div>
        <div class="batsman-card">
            <div class="batsman-name" id="s2Name">Non-Striker</div>
            <div class="batsman-stats" id="s2Stats">0(0)</div>
        </div>
    </div>
    <div class="bowler-info">
        <div class="bowler-label">BOWLER</div>
        <div class="bowler-name" id="bowlerName">-</div>
        <div class="bowler-stats" id="bowlerStats">0-0 (0.0)</div>
    </div>
    <div class="current-over">
        <div class="over-title">Current Over</div>
        <div class="balls-container" id="overBalls"><div class="ball-dot">-</div></div>
    </div>
    <div class="scoring-grid">
        <button class="score-btn dot" onclick="recordRun(0,'dot')">0</button>
        <button class="score-btn runs" onclick="recordRun(1)">1</button>
        <button class="score-btn runs" onclick="recordRun(2)">2</button>
        <button class="score-btn runs" onclick="recordRun(3)">3</button>
        <button class="score-btn runs" onclick="recordRun(4)">4</button>
        <button class="score-btn runs" onclick="recordRun(6)">6</button>
        <button class="score-btn wicket" onclick="showWicketModal()">W</button>
        <button class="score-btn extra" onclick="toggleExtras()">+EXT</button>
    </div>
    <div id="extrasSection" style="display:none">
        <div class="extras-grid">
            <button class="extra-btn" onclick="recordExtra('wide')">Wide</button>
            <button class="extra-btn" onclick="recordExtra('noball')">No Ball</button>
            <button class="extra-btn" onclick="recordExtra('bye')">Bye</button>
            <button class="extra-btn" onclick="recordExtra('legbye')">Leg Bye</button>
        </div>
    </div>
    <div class="action-buttons">
        <button class="action-btn undo-btn" onclick="undoLastBall()">â†¶ Undo</button>
        <button class="action-btn scorecard-btn" onclick="toggleScorecard()">ğŸ“Š Scorecard</button>
        <button class="action-btn end-innings-btn" onclick="endInnings()">End Innings</button>
        <button class="action-btn end-match-btn" onclick="endMatch()">End Match</button>
    </div>
    <div id="scPanel" style="display:none;margin-top:10px">
        <div class="sc-wrap">
            <div class="sc-head" onclick="toggleScorecard()"><span>ğŸ“Š Live Scorecard</span><span>âœ•</span></div>
            <div class="sc-body" id="scBody"></div>
        </div>
    </div>
</div>

<!-- SAVED TEAMS -->
<div id="savedTeamsScreen" class="screen">
    <div style="font-size:20px;font-weight:bold;color:#333;margin-bottom:20px;padding-bottom:10px;border-bottom:3px solid #ff6b35">ğŸ“‹ Saved Teams</div>
    <div id="savedTeamsList"></div>
    <div style="text-align:center;margin-top:30px"><button class="btn btn-secondary" onclick="showHome()">Back</button></div>
</div>

<!-- MATCH HISTORY -->
<div id="matchHistoryScreen" class="screen">
    <div style="font-size:20px;font-weight:bold;color:#333;margin-bottom:20px;padding-bottom:10px;border-bottom:3px solid #ff6b35">ğŸ“Š Match History</div>
    <div id="matchHistoryList"></div>
    <div style="text-align:center;margin-top:30px"><button class="btn btn-secondary" onclick="showHome()">Back</button></div>
</div>

</div><!-- /container -->

<!-- â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â• -->

<!-- Batsman / Bowler picker (reused) -->
<div id="pickerModal" class="modal">
    <div class="modal-content">
        <div class="modal-header" id="pickerTitle"></div>
        <div id="pickerBody"></div>
    </div>
</div>

<!-- Wicket Step 1: dismissal type -->
<div id="wicketModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">ğŸ Wicket!</div>
        <p style="text-align:center;margin-bottom:14px;color:#666;font-size:14px">How was the batsman dismissed?</p>
        <div class="dismissal-grid">
            <button class="dis-btn" onclick="onDismissalType('caught')"><span class="ico">ğŸ¤²</span><span>Caught</span></button>
            <button class="dis-btn" onclick="onDismissalType('bowled')"><span class="ico">ğŸ¯</span><span>Bowled</span></button>
            <button class="dis-btn" onclick="onDismissalType('lbw')"><span class="ico">ğŸ¦µ</span><span>LBW</span></button>
            <button class="dis-btn" onclick="onDismissalType('stumped')"><span class="ico">ğŸ§¤</span><span>Stumped</span></button>
            <button class="dis-btn" onclick="onDismissalType('runout')"><span class="ico">ğŸƒ</span><span>Run Out</span></button>
            <button class="dis-btn" onclick="onDismissalType('other')"><span class="ico">â“</span><span>Other</span></button>
            <button class="dis-btn retired-btn" onclick="onRetiredHurt()">
                <span class="ico">ğŸ¥</span>
                <span class="lbl">Retired Hurt / Out<span class="sub">Not dismissed â€” wicket NOT counted</span></span>
            </button>
        </div>
        <div style="text-align:center"><button class="btn btn-secondary" onclick="closeModal('wicketModal')" style="font-size:13px;padding:8px 20px">Cancel</button></div>
    </div>
</div>

<!-- Wicket Step 2: run out â€” who? -->
<div id="runoutModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">ğŸƒ Run Out â€” Who's Out?</div>
        <p style="text-align:center;margin-bottom:12px;color:#666;font-size:14px">Select the batsman who was run out:</p>
        <div id="runoutBody"></div>
        <div style="text-align:center;margin-top:8px"><button class="btn btn-secondary" onclick="closeModal('runoutModal')" style="font-size:13px;padding:8px 20px">Cancel</button></div>
    </div>
</div>

<!-- Retired: who? -->
<div id="retiredModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">ğŸ¥ Retired â€” Who's Leaving?</div>
        <p style="text-align:center;margin-bottom:12px;color:#666;font-size:14px">Select the batsman retiring from the field:</p>
        <div id="retiredBody"></div>
        <div style="background:#fff3e0;border-radius:8px;padding:10px;margin:10px 0;font-size:13px;color:#888;text-align:center">Wicket count does NOT increase for Retired Hurt.</div>
        <div style="text-align:center"><button class="btn btn-secondary" onclick="closeModal('retiredModal')" style="font-size:13px;padding:8px 20px">Cancel</button></div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyCpV2GXvuCog7bTQoutpOoQovGvtYeqclw",authDomain:"gully-score.firebaseapp.com",databaseURL:"https://gully-score-default-rtdb.asia-southeast1.firebasedatabase.app/",projectId:"gully-score",storageBucket:"gully-score.firebasestorage.app",messagingSenderId:"305069405268",appId:"1:305069405268:web:f368add1f10132bee829c1"};
let db,currentMatchId;
const PASS='Hari@1016',SESS='gullyScoreAdminSession',AMK='gullyScoreActiveMatch';

// â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkPassword(){
    const pw=document.getElementById('adminPassword').value,err=document.getElementById('loginError');
    if(pw===PASS){sessionStorage.setItem(SESS,'ok');document.getElementById('loginScreen').classList.remove('active');document.getElementById('mainHeader').style.display='block';checkForActiveMatch();err.style.display='none';}
    else{err.textContent='Incorrect password.';err.style.display='block';document.getElementById('adminPassword').value='';}
}
function logout(){if(confirm('Logout?')){sessionStorage.removeItem(SESS);localStorage.removeItem(AMK);location.reload();}}
function checkAuthentication(){
    if(sessionStorage.getItem(SESS)==='ok'){document.getElementById('loginScreen').classList.remove('active');document.getElementById('mainHeader').style.display='block';checkForActiveMatch();}
    else{document.getElementById('loginScreen').classList.add('active');document.getElementById('mainHeader').style.display='none';}
}
function checkForActiveMatch(){
    const id=localStorage.getItem(AMK);
    if(id&&db){db.ref('matches/'+id).once('value').then(function(s){const d=s.val();if(d&&d.matchStatus==='live'&&confirm('Active match found. Continue?')){loadActiveMatch(d);}else{localStorage.removeItem(AMK);showHome();}}).catch(function(){localStorage.removeItem(AMK);showHome();});}
    else showHome();
}
function loadActiveMatch(d){
    GS=d;currentMatchId=d.matchId;
    if(!GS.ballHistory)GS.ballHistory=[];
    if(GS.matchStartTime)startTimer();
    showScreen('scoringScreen');updateDisplay();
}
function saveAM(){if(currentMatchId&&GS.matchStatus==='live')localStorage.setItem(AMK,currentMatchId);else localStorage.removeItem(AMK);}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init(){
    try{if(!firebase.apps.length)firebase.initializeApp(firebaseConfig);db=firebase.database();}catch(e){console.error(e);}
    genPlayers('A');genPlayers('B');updateTime();checkAuthentication();setInterval(updateTime,60000);
}
function updateTime(){document.getElementById('currentTime').textContent='ğŸ“… '+new Date().toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'});}
function genPlayers(t){
    const c=document.getElementById('team'+t+'PlayersList');c.innerHTML='';
    for(let i=1;i<=11;i++){const r=document.createElement('div');r.className='player-input-row';r.innerHTML='<div class="player-number">'+i+'</div><input type="text" class="player-input" placeholder="Player '+i+' Name" id="team'+t+'Player'+i+'">';c.appendChild(r);}
}
function togglePlayers(t){document.getElementById('team'+t+'Players').classList.toggle('show');}
function showSetup(){showScreen('setupScreen');populateDropdowns();}
function proceedToToss(){
    document.getElementById('tossTeamA').textContent=document.getElementById('teamAName').value.trim()||'Team A';
    document.getElementById('tossTeamB').textContent=document.getElementById('teamBName').value.trim()||'Team B';
    showScreen('tossScreen');
}
let tossW=null,tossD=null;
function selectTossWinner(t){tossW=t;document.querySelectorAll('.toss-card').forEach(function(c){c.classList.remove('selected');});event.target.closest('.toss-card').classList.add('selected');document.getElementById('decisionSection').style.display='block';}
function selectDecision(d){tossD=d;document.querySelectorAll('.decision-card').forEach(function(c){c.classList.remove('selected');});event.target.closest('.decision-card').classList.add('selected');document.getElementById('startMatchBtn').style.display='inline-block';}

// â”€â”€ GAME STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let GS={teamA:{name:'',players:[]},teamB:{name:'',players:[]},overs:5,battingTeam:null,bowlingTeam:null,striker:null,nonStriker:null,bowler:null,score:0,wickets:0,currentOver:0,currentBall:0,overBalls:[],innings:1,matchStatus:'live',firstInningsScore:0,firstInningsWickets:0,firstInningsOvers:0,firstInningsBatting:[],firstInningsBowling:[],firstInningsBattingTeam:null,ballHistory:[],matchStartTime:null};

function mkPlayer(name){return{name:name.trim()||'Player',runs:0,balls:0,fours:0,sixes:0,isOut:false,isRetired:false,dismissalType:null,bowlingBalls:0,bowlingRuns:0,bowlingWickets:0,bowlingMaidens:0};}

// â”€â”€ START MATCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startMatch(){
    if(!tossW||!tossD){alert('Complete the toss first');return;}
    GS.overs=parseInt(document.getElementById('oversInput').value)||5;
    GS.teamA.name=document.getElementById('teamAName').value.trim()||'Team A';
    GS.teamB.name=document.getElementById('teamBName').value.trim()||'Team B';
    GS.teamA.players=[];GS.teamB.players=[];
    const na=[],nb=[];
    for(let i=1;i<=11;i++){
        const a=document.getElementById('teamAPlayer'+i).value,b=document.getElementById('teamBPlayer'+i).value;
        if(a.trim()){GS.teamA.players.push(mkPlayer(a));na.push(a.trim());}
        if(b.trim()){GS.teamB.players.push(mkPlayer(b));nb.push(b.trim());}
    }
    if(GS.teamA.players.length<2||GS.teamB.players.length<2){alert('Each team needs at least 2 players');return;}
    saveTeam(GS.teamA.name,na);saveTeam(GS.teamB.name,nb);
    const bf=((tossW==='A'&&tossD==='bat')||(tossW==='B'&&tossD==='bowl'))?'teamA':'teamB';
    GS.battingTeam=bf==='teamA'?GS.teamA:GS.teamB;
    GS.bowlingTeam=bf==='teamA'?GS.teamB:GS.teamA;
    GS.firstInningsBattingTeam=bf;
    GS.ballHistory=[];GS.matchStartTime=Date.now();
    currentMatchId='match_'+Date.now();
    startTimer();
    openPicker('opening-bat');
}

// â”€â”€ TIMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let timerInt=null;
function startTimer(){
    if(timerInt)clearInterval(timerInt);
    timerInt=setInterval(function(){
        if(!GS.matchStartTime)return;
        const e=Math.floor((Date.now()-GS.matchStartTime)/1000);
        const m=String(Math.floor(e/60)).padStart(2,'0'),s=String(e%60).padStart(2,'0');
        const el=document.getElementById('timerBadge');if(el)el.textContent='â± '+m+':'+s;
    },1000);
}

// â”€â”€ UNIVERSAL PICKER (batsman + bowler) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// modes: 'opening-bat','new-bowler-opening','new-bowler',
//        {wicket:{outPlayer,outIsStriker}}, {retired:{player,isStriker}}
function openPicker(mode){
    const title=document.getElementById('pickerTitle'),body=document.getElementById('pickerBody');
    body.innerHTML='';

    if(mode==='opening-bat'){
        title.textContent='ğŸ Opening Batsmen';
        const n=GS.battingTeam.players.length;
        body.innerHTML='<div style="margin-bottom:14px"><label style="display:block;margin-bottom:6px;font-weight:bold;color:#333">Striker: <span style="color:#ff6b35;font-size:12px;">('+n+' players)</span></label><select id="ps1" style="width:100%;padding:11px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;background:white"><option value="">-- Select --</option></select></div><div style="margin-bottom:14px"><label style="display:block;margin-bottom:6px;font-weight:bold;color:#333">Non-Striker: <span style="color:#ff6b35;font-size:12px;">('+n+' players)</span></label><select id="ps2" style="width:100%;padding:11px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;background:white"><option value="">-- Select --</option></select></div>';
        GS.battingTeam.players.forEach(function(p,i){document.getElementById('ps1').innerHTML+='<option value="'+i+'">'+p.name+'</option>';document.getElementById('ps2').innerHTML+='<option value="'+i+'">'+p.name+'</option>';});
        addBtn(body,'Confirm',function(){
            const a=document.getElementById('ps1').value,b=document.getElementById('ps2').value;
            if(a===''||b===''){alert('Select both batsmen');return;}
            if(a===b){alert('Select different batsmen');return;}
            GS.striker=GS.battingTeam.players[a];GS.nonStriker=GS.battingTeam.players[b];
            closeModal('pickerModal');openPicker('new-bowler-opening');
        });

    } else if(mode==='new-bowler-opening'||mode==='new-bowler'){
        const isOpen=(mode==='new-bowler-opening');
        title.textContent=isOpen?'âš¾ Select Opening Bowler':'âš¾ Select Bowler';
        const n=GS.bowlingTeam.players.length;
        body.innerHTML='<div style="margin-bottom:14px"><label style="display:block;margin-bottom:6px;font-weight:bold;color:#333">Bowler: <span style="color:#ff6b35;font-size:12px;">('+n+' players)</span></label><select id="pb" style="width:100%;padding:11px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;background:white"><option value="">-- Select --</option></select></div>';
        GS.bowlingTeam.players.forEach(function(p,i){if(!isOpen&&p===GS.bowler)return;document.getElementById('pb').innerHTML+='<option value="'+i+'">'+p.name+'</option>';});
        addBtn(body,isOpen?'Start Match':'Confirm',function(){
            const idx=document.getElementById('pb').value;if(idx===''){alert('Select a bowler');return;}
            GS.bowler=GS.bowlingTeam.players[idx];closeModal('pickerModal');
            if(isOpen){showScreen('scoringScreen');updateDisplay();saveToFB();}
            else{updateDisplay();saveToFB();}
        });

    } else if(mode.wicket){
        const op=mode.wicket.outPlayer,ois=mode.wicket.outIsStriker;
        title.textContent='ğŸ New Batsman';
        const dis=disLabel(op.dismissalType);
        const info=document.createElement('div');
        info.style.cssText='background:#fff3e0;border-radius:8px;padding:10px;margin-bottom:12px;text-align:center';
        info.innerHTML='<div style="font-size:13px;color:#666">'+dis+'</div><div style="font-size:17px;font-weight:bold;color:#dc3545">'+op.name+' is out</div><div style="font-size:12px;color:#999;margin-top:3px">'+op.runs+' runs ('+op.balls+' balls)</div>';
        body.appendChild(info);
        const lbl=document.createElement('p');lbl.style.cssText='text-align:center;color:#666;font-size:14px;margin-bottom:10px';lbl.textContent='Select the next batsman:';body.appendChild(lbl);
        const avail=GS.battingTeam.players.filter(function(p){return !p.isOut&&!p.isRetired&&p!==GS.striker&&p!==GS.nonStriker;});
        if(avail.length===0){body.innerHTML+='<p style="text-align:center;color:#999;padding:20px">No more batsmen available.</p>';}
        else{avail.forEach(function(p){const o=document.createElement('div');o.className='player-option';o.textContent=p.name;o.onclick=(function(pl){return function(){if(ois)GS.striker=pl;else GS.nonStriker=pl;closeModal('pickerModal');updateDisplay();saveToFB();};})(p);body.appendChild(o);});}

    } else if(mode.retired){
        const rp=mode.retired.player,ris=mode.retired.isStriker;
        title.textContent='ğŸ¥ New Batsman (Retired)';
        const info=document.createElement('div');
        info.style.cssText='background:#fff8f0;border:2px solid #fd7e14;border-radius:8px;padding:10px;margin-bottom:12px;text-align:center';
        info.innerHTML='<div style="color:#fd7e14;font-weight:bold;font-size:13px">ğŸ¥ Retired Hurt</div><div style="font-size:17px;font-weight:bold;color:#333">'+rp.name+' has left the field</div><div style="font-size:12px;color:#999;margin-top:3px">'+rp.runs+' runs ('+rp.balls+' balls) Â· Wicket NOT counted</div>';
        body.appendChild(info);
        const lbl=document.createElement('p');lbl.style.cssText='text-align:center;color:#666;font-size:14px;margin-bottom:10px';lbl.textContent='Select the incoming batsman:';body.appendChild(lbl);
        const avail=GS.battingTeam.players.filter(function(p){return !p.isOut&&!p.isRetired&&p!==GS.striker&&p!==GS.nonStriker;});
        if(avail.length===0){body.innerHTML+='<p style="text-align:center;color:#999;padding:20px">No replacements available.</p>';}
        else{avail.forEach(function(p){const o=document.createElement('div');o.className='player-option';o.textContent=p.name;o.onclick=(function(pl){return function(){if(ris)GS.striker=pl;else GS.nonStriker=pl;closeModal('pickerModal');updateDisplay();saveToFB();};})(p);body.appendChild(o);});}
    }

    document.getElementById('pickerModal').classList.add('active');
}
function addBtn(body,text,fn){const b=document.createElement('button');b.className='btn btn-primary';b.style.width='100%';b.textContent=text;b.onclick=fn;body.appendChild(b);}

// â”€â”€ UNDO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveSnap(){
    const s={score:GS.score,wickets:GS.wickets,currentOver:GS.currentOver,currentBall:GS.currentBall,overBalls:JSON.parse(JSON.stringify(GS.overBalls)),sn:GS.striker?GS.striker.name:null,nn:GS.nonStriker?GS.nonStriker.name:null,bn:GS.bowler?GS.bowler.name:null,bat:GS.battingTeam.players.map(function(p){return{name:p.name,runs:p.runs,balls:p.balls,fours:p.fours,sixes:p.sixes,isOut:p.isOut,isRetired:p.isRetired,dismissalType:p.dismissalType};}),bowl:GS.bowlingTeam.players.map(function(p){return{name:p.name,bowlingBalls:p.bowlingBalls,bowlingRuns:p.bowlingRuns,bowlingWickets:p.bowlingWickets};})};
    if(!GS.ballHistory)GS.ballHistory=[];GS.ballHistory.push(s);if(GS.ballHistory.length>20)GS.ballHistory.shift();
}
function undoLastBall(){
    if(!GS.ballHistory||GS.ballHistory.length===0){alert('Nothing to undo');return;}
    if(!confirm('Undo last ball?'))return;
    const s=GS.ballHistory.pop();
    GS.score=s.score;GS.wickets=s.wickets;GS.currentOver=s.currentOver;GS.currentBall=s.currentBall;GS.overBalls=s.overBalls;
    s.bat.forEach(function(sb){const p=GS.battingTeam.players.find(function(x){return x.name===sb.name;});if(p){p.runs=sb.runs;p.balls=sb.balls;p.fours=sb.fours;p.sixes=sb.sixes;p.isOut=sb.isOut;p.isRetired=sb.isRetired;p.dismissalType=sb.dismissalType;}});
    s.bowl.forEach(function(sb){const p=GS.bowlingTeam.players.find(function(x){return x.name===sb.name;});if(p){p.bowlingBalls=sb.bowlingBalls;p.bowlingRuns=sb.bowlingRuns;p.bowlingWickets=sb.bowlingWickets;}});
    if(s.sn)GS.striker=GS.battingTeam.players.find(function(p){return p.name===s.sn;});
    if(s.nn)GS.nonStriker=GS.battingTeam.players.find(function(p){return p.name===s.nn;});
    if(s.bn)GS.bowler=GS.bowlingTeam.players.find(function(p){return p.name===s.bn;});
    updateDisplay();saveToFB();
}

// â”€â”€ SCORING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function recordRun(r,t){
    if(GS.matchStatus!=='live')return;saveSnap();
    GS.striker.runs+=r;GS.striker.balls++;GS.score+=r;
    if(r===4)GS.striker.fours++;if(r===6)GS.striker.sixes++;
    GS.bowler.bowlingBalls++;GS.bowler.bowlingRuns+=r;
    let cls='',val=r;
    if(t==='dot'){cls='dot';val='â€¢';}else if(r===1||r===2||r===3)cls='one';else if(r===4)cls='four';else if(r===6)cls='six';
    GS.overBalls.push({value:val,class:cls});
    if(r%2===1)swapStr();
    if(GS.innings===2&&GS.score>=GS.firstInningsScore+1){advBall();updateDisplay();saveToFB();setTimeout(showCompleted,500);return;}
    advBall();updateDisplay();saveToFB();
}
function recordExtra(t){
    if(GS.matchStatus!=='live')return;saveSnap();
    GS.score++;GS.bowler.bowlingRuns++;
    const v=t==='wide'?'WD':t==='noball'?'NB':t==='bye'?'B':'LB';
    GS.overBalls.push({value:v,class:t});
    if(t!=='wide'&&t!=='noball'){GS.striker.balls++;GS.bowler.bowlingBalls++;advBall();}
    updateDisplay();saveToFB();
}
function toggleExtras(){const s=document.getElementById('extrasSection');s.style.display=s.style.display==='none'?'block':'none';}

// â”€â”€ WICKET FLOW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showWicketModal(){if(GS.matchStatus!=='live')return;document.getElementById('wicketModal').classList.add('active');}

function onDismissalType(type){
    closeModal('wicketModal');
    if(type==='runout'){
        const body=document.getElementById('runoutBody');body.innerHTML='';
        [GS.striker,GS.nonStriker].forEach(function(player){
            const role=player===GS.striker?'Striker':'Non-Striker';
            const btn=document.createElement('button');btn.className='pick-btn';
            btn.innerHTML='<div class="pn">ğŸƒ '+player.name+'</div><div class="pi">'+role+' Â· '+player.runs+'('+player.balls+')</div>';
            btn.onclick=(function(p){return function(){closeModal('runoutModal');doWicket(p,'runout');};})(player);
            body.appendChild(btn);
        });
        document.getElementById('runoutModal').classList.add('active');
    } else {
        doWicket(GS.striker,type); // caught/bowled/lbw/stumped/other â€” always striker
    }
}

function doWicket(outPlayer,dismissalType){
    saveSnap();
    const outIsStriker=(outPlayer===GS.striker);
    outPlayer.isOut=true;outPlayer.dismissalType=dismissalType;
    GS.striker.balls++;GS.wickets++;GS.bowler.bowlingBalls++;
    if(dismissalType!=='runout')GS.bowler.bowlingWickets++;
    GS.overBalls.push({value:'W',class:'wicket'});
    const allOut=GS.wickets>=GS.battingTeam.players.length-1||GS.wickets>=10;
    advBall();updateDisplay();saveToFB();
    if(allOut){setTimeout(function(){if(GS.innings===2)showCompleted();else endInnings();},400);}
    else{openPicker({wicket:{outPlayer:outPlayer,outIsStriker:outIsStriker}});}
}

// â”€â”€ RETIRED HURT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onRetiredHurt(){
    closeModal('wicketModal');
    const body=document.getElementById('retiredBody');body.innerHTML='';
    [GS.striker,GS.nonStriker].forEach(function(player){
        const role=player===GS.striker?'Striker':'Non-Striker';
        const btn=document.createElement('button');btn.className='pick-btn';btn.style.borderColor='#fd7e14';
        btn.innerHTML='<div class="pn">ğŸ¥ '+player.name+'</div><div class="pi">'+role+' Â· '+player.runs+'('+player.balls+')</div>';
        btn.onclick=(function(p){return function(){closeModal('retiredModal');doRetired(p);};})(player);
        body.appendChild(btn);
    });
    document.getElementById('retiredModal').classList.add('active');
}

function doRetired(player){
    saveSnap();
    const isStriker=(player===GS.striker); // capture BEFORE any changes
    player.isRetired=true;player.dismissalType='retired_hurt';
    // wicket count does NOT increase
    const avail=GS.battingTeam.players.filter(function(p){return !p.isOut&&!p.isRetired&&p!==GS.striker&&p!==GS.nonStriker;});
    updateDisplay();saveToFB();
    if(avail.length===0){alert(player.name+' retired. No replacements â€” ending innings.');endInnings();return;}
    openPicker({retired:{player:player,isStriker:isStriker}});
}

// â”€â”€ BALL/OVER ADVANCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function advBall(){
    GS.currentBall++;
    if(GS.currentBall>=6){GS.currentBall=0;GS.currentOver++;GS.overBalls=[];swapStr();
        if(GS.currentOver>=GS.overs)setTimeout(endInnings,500);else openPicker('new-bowler');}
}
function swapStr(){const t=GS.striker;GS.striker=GS.nonStriker;GS.nonStriker=t;}

// â”€â”€ INNINGS / MATCH END â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function endInnings(){
    if(GS.innings===1){
        GS.firstInningsScore=GS.score;GS.firstInningsWickets=GS.wickets;GS.firstInningsOvers=GS.currentOver+'.'+GS.currentBall;
        GS.firstInningsBatting=JSON.parse(JSON.stringify(GS.battingTeam.players.filter(function(p){return p.balls>0||p.isOut||p.isRetired;})));
        GS.firstInningsBowling=JSON.parse(JSON.stringify(GS.bowlingTeam.players.filter(function(p){return p.bowlingBalls>0;})));
        const tmp=GS.battingTeam;GS.battingTeam=GS.bowlingTeam;GS.bowlingTeam=tmp;
        GS.battingTeam.players.forEach(function(p){p.runs=0;p.balls=0;p.fours=0;p.sixes=0;p.isOut=false;p.isRetired=false;p.dismissalType=null;});
        GS.bowlingTeam.players.forEach(function(p){p.bowlingBalls=0;p.bowlingRuns=0;p.bowlingWickets=0;p.bowlingMaidens=0;});
        GS.score=0;GS.wickets=0;GS.currentOver=0;GS.currentBall=0;GS.overBalls=[];GS.innings=2;GS.striker=null;GS.nonStriker=null;GS.bowler=null;GS.ballHistory=[];
        alert('First innings complete! Starting second innings...');openPicker('opening-bat');
    } else endMatch();
}
function showCompleted(){
    GS.matchStatus='completed';saveToFB();if(timerInt){clearInterval(timerInt);timerInt=null;}
    const tgt=GS.firstInningsScore+1;
    let res='';if(GS.innings===2){res=GS.score>=tgt?GS.battingTeam.name+' won by '+(10-GS.wickets)+' wickets':GS.bowlingTeam.name+' won by '+(tgt-GS.score-1)+' runs';}
    document.querySelectorAll('.screen').forEach(function(s){s.classList.remove('active');});
    const old=document.getElementById('mcs');if(old)old.remove();
    const d=document.createElement('div');d.id='mcs';d.style.cssText='padding:40px 20px;text-align:center';
    d.innerHTML='<div style="margin-top:60px"><div style="font-size:80px;margin-bottom:20px">ğŸ†</div><h2 style="font-size:32px;color:#ff6b35;margin-bottom:20px">Match Completed!</h2><div style="background:white;padding:30px;border-radius:15px;box-shadow:0 5px 25px rgba(0,0,0,.1);margin-bottom:30px"><div style="font-size:24px;font-weight:bold;color:#333;margin-bottom:15px">'+res+'</div><div style="font-size:18px;color:#666;margin-bottom:10px">'+GS.teamA.name+' vs '+GS.teamB.name+'</div><div style="font-size:16px;color:#999">1st: '+GS.firstInningsScore+'/'+GS.firstInningsWickets+' ('+GS.firstInningsOvers+')</div><div style="font-size:16px;color:#999">2nd: '+GS.score+'/'+GS.wickets+' ('+GS.currentOver+'.'+GS.currentBall+')</div></div><button onclick="goHome()" style="background:linear-gradient(135deg,#28a745,#20c997);color:white;border:none;padding:18px 50px;border-radius:50px;font-size:20px;font-weight:bold;cursor:pointer">ğŸ  Go Home</button></div>';
    document.querySelector('.container').appendChild(d);
}
function goHome(){const s=document.getElementById('mcs');if(s)s.remove();showHome();}
function endMatch(){showCompleted();}

// â”€â”€ DISPLAY UPDATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateDisplay(){
    document.getElementById('vsTeams').textContent=GS.teamA.name+' vs '+GS.teamB.name;
    document.getElementById('inningsBadge').textContent=GS.innings+(GS.innings===1?'st':'nd')+' Innings - '+GS.battingTeam.name;
    document.getElementById('mainScore').textContent=GS.score+'/'+GS.wickets;
    document.getElementById('oversInfo').textContent='Overs: '+GS.currentOver+'.'+GS.currentBall+' / '+GS.overs;
    const ti=document.getElementById('targetInfo');
    if(GS.innings===2){ti.classList.add('show');const tgt=GS.firstInningsScore+1,req=tgt-GS.score,bl=(GS.overs*6)-(GS.currentOver*6+GS.currentBall);document.getElementById('targetRuns').textContent=req>0?'Need '+req+' runs to win':'Target achieved!';document.getElementById('targetBalls').textContent=bl+' balls remaining';}
    else ti.classList.remove('show');
    if(GS.striker){document.getElementById('s1Name').innerHTML='<span class="strike-indicator"></span>'+GS.striker.name;document.getElementById('s1Stats').textContent=GS.striker.runs+'('+GS.striker.balls+')';}
    if(GS.nonStriker){document.getElementById('s2Name').textContent=GS.nonStriker.name;document.getElementById('s2Stats').textContent=GS.nonStriker.runs+'('+GS.nonStriker.balls+')';}
    if(GS.bowler){document.getElementById('bowlerName').textContent=GS.bowler.name;const bo=Math.floor(GS.bowler.bowlingBalls/6),bb=GS.bowler.bowlingBalls%6;document.getElementById('bowlerStats').textContent=GS.bowler.bowlingWickets+'-'+GS.bowler.bowlingRuns+' ('+bo+'.'+bb+')';}
    const bc=document.getElementById('overBalls');bc.innerHTML='';
    if(GS.overBalls.length===0)bc.innerHTML='<div class="ball-dot">-</div>';
    else GS.overBalls.forEach(function(b){const d=document.createElement('div');d.className='ball-dot '+b.class;d.textContent=b.value;bc.appendChild(d);});
    const sp=document.getElementById('scPanel');if(sp&&sp.style.display!=='none')renderSC();
}

// â”€â”€ INLINE SCORECARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleScorecard(){const p=document.getElementById('scPanel');if(p.style.display==='none'){p.style.display='block';renderSC();p.scrollIntoView({behavior:'smooth',block:'nearest'});}else p.style.display='none';}

function disLabel(t){return{caught:'ğŸ¤² Caught',bowled:'ğŸ¯ Bowled',runout:'ğŸƒ Run Out',lbw:'ğŸ¦µ LBW',stumped:'ğŸ§¤ Stumped',retired_hurt:'ğŸ¥ Retired',other:'Out'}[t]||'Out';}
function disShort(t){return{caught:'c',bowled:'b',runout:'ro',lbw:'lbw',stumped:'st',retired_hurt:'retâ€ ',other:'out'}[t]||'out';}

function renderSC(){
    const el=document.getElementById('scBody');
    const th='background:#f8f9fa;padding:6px 5px;text-align:left;font-size:11px;color:#666;font-weight:600;border-bottom:2px solid #e0e0e0;',td='padding:6px 5px;border-bottom:1px solid #f0f0f0;',tc=td+'text-align:center;';
    let h='<div style="text-align:center;font-weight:bold;color:#333;margin-bottom:8px;font-size:14px">'+GS.teamA.name+' vs '+GS.teamB.name+'</div>';
    if(GS.innings===2&&GS.firstInningsBatting&&GS.firstInningsBatting.length>0){
        h+='<div class="sc-sec">ğŸ 1st Innings Batting</div>';
        h+='<table class="sc-table"><thead><tr><th style="'+th+'">Batsman</th><th class="r" style="'+th+'">R</th><th class="r" style="'+th+'">B</th><th class="r" style="'+th+'">4s</th><th class="r" style="'+th+'">6s</th><th class="r" style="'+th+'">SR</th></tr></thead><tbody>';
        GS.firstInningsBatting.forEach(function(p){
            const sr=p.balls>0?((p.runs/p.balls)*100).toFixed(1):'0.0';
            const badge=p.isOut?'<span style="color:#dc3545;font-size:10px">'+disShort(p.dismissalType)+'</span>':p.isRetired?'<span style="color:#fd7e14;font-size:10px">ret</span>':'<span style="color:#28a745;font-size:10px">*</span>';
            h+='<tr><td style="'+td+'">'+p.name+' '+badge+'</td><td style="'+tc+'"><b>'+p.runs+'</b></td><td style="'+tc+'">'+p.balls+'</td><td style="'+tc+'">'+(p.fours||0)+'</td><td style="'+tc+'">'+(p.sixes||0)+'</td><td style="'+tc+'">'+sr+'</td></tr>';
        });
        h+='</tbody></table><div style="text-align:center;font-size:12px;color:#666;margin-bottom:8px">'+GS.firstInningsScore+'/'+GS.firstInningsWickets+' ('+GS.firstInningsOvers+' ov)</div>';
        if(GS.firstInningsBowling&&GS.firstInningsBowling.length>0){
            h+='<div class="sc-sec">âš¾ 1st Innings Bowling</div>';
            h+='<table class="sc-table"><thead><tr><th style="'+th+'">Bowler</th><th class="r" style="'+th+'">O</th><th class="r" style="'+th+'">R</th><th class="r" style="'+th+'">W</th></tr></thead><tbody>';
            GS.firstInningsBowling.forEach(function(p){const ov=Math.floor(p.bowlingBalls/6)+'.'+(p.bowlingBalls%6);h+='<tr><td style="'+td+'">'+p.name+'</td><td style="'+tc+'">'+ov+'</td><td style="'+tc+'">'+p.bowlingRuns+'</td><td style="'+tc+';color:#dc3545"><b>'+p.bowlingWickets+'</b></td></tr>';});
            h+='</tbody></table>';
        }
        h+='<hr style="border:none;border-top:2px solid #f0f0f0;margin:8px 0">';
    }
    const batters=GS.battingTeam.players.filter(function(p){return p.balls>0||p.isOut||p.isRetired;});
    if(batters.length>0){
        h+='<div class="sc-sec">ğŸ '+(GS.innings===2?'2nd Innings ':'')+'Batting - '+GS.battingTeam.name+'</div>';
        h+='<table class="sc-table"><thead><tr><th style="'+th+'">Batsman</th><th class="r" style="'+th+'">R</th><th class="r" style="'+th+'">B</th><th class="r" style="'+th+'">4s</th><th class="r" style="'+th+'">6s</th><th class="r" style="'+th+'">SR</th></tr></thead><tbody>';
        batters.forEach(function(p){
            const sr=p.balls>0?((p.runs/p.balls)*100).toFixed(1):'0.0';
            const isStr=GS.striker&&p.name===GS.striker.name;
            const rBg=isStr?'background:#fff3e0;':p.isRetired?'background:#fff8f0;':'';
            const badge=p.isOut?'<span style="color:#dc3545;font-size:10px">'+disShort(p.dismissalType)+'</span>':p.isRetired?'<span style="color:#fd7e14;font-size:10px">ğŸ¥ret</span>':'';
            h+='<tr style="'+rBg+'"><td style="'+td+'">'+p.name+(isStr?' *':'')+' '+badge+'</td><td style="'+tc+'"><b>'+p.runs+'</b></td><td style="'+tc+'">'+p.balls+'</td><td style="'+tc+'">'+(p.fours||0)+'</td><td style="'+tc+'">'+(p.sixes||0)+'</td><td style="'+tc+'">'+sr+'</td></tr>';
        });
        h+='</tbody></table><div style="text-align:center;font-size:12px;color:#666;margin-bottom:8px">'+GS.score+'/'+GS.wickets+' ('+GS.currentOver+'.'+GS.currentBall+' ov)</div>';
    }
    const bwrs=GS.bowlingTeam.players.filter(function(p){return p.bowlingBalls>0;});
    if(bwrs.length>0){
        h+='<div class="sc-sec">âš¾ '+(GS.innings===2?'2nd Innings ':'')+'Bowling - '+GS.bowlingTeam.name+'</div>';
        h+='<table class="sc-table"><thead><tr><th style="'+th+'">Bowler</th><th class="r" style="'+th+'">O</th><th class="r" style="'+th+'">R</th><th class="r" style="'+th+'">W</th></tr></thead><tbody>';
        bwrs.forEach(function(p){const isCurr=GS.bowler&&p.name===GS.bowler.name;const ov=Math.floor(p.bowlingBalls/6)+'.'+(p.bowlingBalls%6);h+='<tr style="'+(isCurr?'background:#fff3e0;':'')+'"><td style="'+td+'">'+p.name+(isCurr?' *':'')+'</td><td style="'+tc+'">'+ov+'</td><td style="'+tc+'">'+p.bowlingRuns+'</td><td style="'+tc+';color:#dc3545"><b>'+p.bowlingWickets+'</b></td></tr>';});
        h+='</tbody></table>';
    }
    el.innerHTML=h;
}

// â”€â”€ FIREBASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveToFB(){
    if(!db||!currentMatchId)return;
    const d=JSON.parse(JSON.stringify(GS));d.lastUpdated=Date.now();d.matchId=currentMatchId;
    db.ref('matches/'+currentMatchId).set(d).then(saveAM).catch(function(e){console.error(e);});
}
function closeModal(id){document.getElementById(id).classList.remove('active');}

// â”€â”€ TEAM MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveTeam(name,players){if(!name||!players.length||!db)return;db.ref('teams/'+name).set({name:name,players:players,lastUsed:Date.now()});}
function getTeams(cb){if(!db){cb({});return;}db.ref('teams').once('value').then(function(s){cb(s.val()||{});}).catch(function(){cb({});});}
function deleteTeam(name){if(confirm('Delete team "'+name+'"?'))db.ref('teams/'+name).remove().then(showSavedTeams);}
function populateDropdowns(){
    getTeams(function(saved){
        const names=Object.keys(saved).sort();
        ['A','B'].forEach(function(t){const s=document.getElementById('team'+t+'LoadSelect');if(!s)return;s.innerHTML='<option value="">-- Load saved team --</option>';names.forEach(function(n){s.innerHTML+='<option value="'+n+'">'+n+'</option>';});});
    });
}
function loadSavedTeam(team,name){
    if(!name)return;
    getTeams(function(saved){
        const d=saved[name];if(!d)return;
        document.getElementById('team'+team+'Name').value=d.name;
        d.players.forEach(function(p,i){const el=document.getElementById('team'+team+'Player'+(i+1));if(el)el.value=p;});
        const pc=document.getElementById('team'+team+'Players');if(!pc.classList.contains('show'))pc.classList.add('show');
    });
}

// â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScreen(id){document.querySelectorAll('.screen').forEach(function(s){s.classList.remove('active');});document.getElementById(id).classList.add('active');}
function showHome(){showScreen('homeScreen');}
function showSavedTeams(){
    showScreen('savedTeamsScreen');
    getTeams(function(saved){
        const list=document.getElementById('savedTeamsList'),keys=Object.keys(saved);
        if(keys.length===0){list.innerHTML='<div style="text-align:center;padding:40px;color:#999"><div style="font-size:60px;margin-bottom:20px">ğŸ“‹</div><p>No saved teams yet</p></div>';return;}
        let h='';Object.values(saved).sort(function(a,b){return b.lastUsed-a.lastUsed;}).forEach(function(t){h+='<div style="background:white;border:2px solid #e0e0e0;border-radius:12px;padding:15px;margin-bottom:15px"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><div><div style="font-size:18px;font-weight:bold;color:#333">'+t.name+'</div><div style="font-size:12px;color:#999">Last used: '+new Date(t.lastUsed).toLocaleDateString()+'</div></div><button onclick="deleteTeam(\''+t.name+'\')" style="background:#dc3545;color:white;border:none;padding:8px 16px;border-radius:8px;cursor:pointer">Delete</button></div><div style="font-size:14px;color:#666"><strong>Players ('+t.players.length+'):</strong> '+t.players.join(', ')+'</div></div>';});
        list.innerHTML=h;
    });
}
function showMatchHistory(){
    showScreen('matchHistoryScreen');
    if(!db){document.getElementById('matchHistoryList').innerHTML='<p style="text-align:center;padding:40px;color:#999">Firebase not initialized</p>';return;}
    document.getElementById('matchHistoryList').innerHTML='<p style="text-align:center;padding:40px;color:#999">Loading...</p>';
    db.ref('matches').orderByChild('lastUpdated').limitToLast(20).once('value').then(function(s){const m=[];s.forEach(function(c){m.push(c.val());});displayHistory(m.reverse());});
}
function displayHistory(matches){
    const list=document.getElementById('matchHistoryList'),done=matches.filter(function(m){return m.matchStatus==='completed';});
    if(done.length===0){list.innerHTML='<div style="text-align:center;padding:40px;color:#999"><div style="font-size:60px;margin-bottom:20px">ğŸ“Š</div><p>No completed matches yet</p></div>';return;}
    let h='';done.forEach(function(m){
        let res='';if(m.innings===2){const t=m.firstInningsScore+1;res=m.score>=t?m.battingTeam.name+' won by '+(10-m.wickets)+' wickets':m.bowlingTeam.name+' won by '+(t-m.score-1)+' runs';}
        h+='<div style="background:white;border:2px solid #e0e0e0;border-radius:12px;padding:15px;margin-bottom:15px"><div style="font-size:16px;font-weight:bold;margin-bottom:5px">'+m.teamA.name+' vs '+m.teamB.name+'</div><div style="font-size:12px;color:#999;margin-bottom:5px">'+new Date(m.lastUpdated).toLocaleString()+'</div><div style="font-size:14px;color:#ff6b35;font-weight:bold;margin-bottom:5px">'+res+'</div><div style="font-size:13px;color:#666">1st: '+m.firstInningsScore+'/'+m.firstInningsWickets+' ('+m.firstInningsOvers+')<br>2nd: '+m.score+'/'+m.wickets+' ('+m.currentOver+'.'+m.currentBall+')</div><button onclick="deleteMatch(\''+m.matchId+'\')" style="background:#dc3545;color:white;border:none;padding:6px 14px;border-radius:8px;cursor:pointer;font-size:13px;margin-top:8px">Delete</button></div>';
    });
    list.innerHTML=h;
}
function deleteMatch(id){if(confirm('Delete this match?'))db.ref('matches/'+id).remove().then(showMatchHistory);}

if('serviceWorker' in navigator)window.addEventListener('load',function(){navigator.serviceWorker.register('sw.js').catch(function(){});});
window.onload=init;
</script>
</body>
</html>
